{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "0baf28fb",
   "metadata": {
    "id": "Xe70I4RRuh3P",
    "papermill": {
     "duration": 0.005931,
     "end_time": "2025-11-14T18:01:50.286365",
     "exception": false,
     "start_time": "2025-11-14T18:01:50.280434",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "# Troubleshooting errors and FAQs\n",
    "\n",
    "This notebook covers some common questions and problems that people may encounter while following the material in the [Kaggle 5-Day AI Agents Intensive Course with Google](https://www.kaggle.com/learn-guide/5-day-agents). It is not intended to be part of the coursework but please check here for your problem before asking in the [Discord](https://discord.com/invite/kaggle) or posting elsewhere."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "042c8a2b",
   "metadata": {
    "papermill": {
     "duration": 0.00456,
     "end_time": "2025-11-14T18:01:50.295790",
     "exception": false,
     "start_time": "2025-11-14T18:01:50.291230",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "## General Questions"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "722f124d",
   "metadata": {
    "papermill": {
     "duration": 0.00462,
     "end_time": "2025-11-14T18:01:50.305054",
     "exception": false,
     "start_time": "2025-11-14T18:01:50.300434",
     "status": "completed"
    },
    "tags": [],
    "vscode": {
     "languageId": "plaintext"
    }
   },
   "source": [
    "### What is in the course?\n",
    "\n",
    "* Please see: [5-Day AI Agents Intensive Course with Google](https://www.kaggle.com/learn-guide/5-day-agents)\n",
    "\n",
    "### Where is the Discord server?\n",
    "\n",
    "* Join here: [Kaggle Discord](https://discord.com/invite/kaggle)\n",
    "\n",
    "### Do I need to submit the notebooks after I complete them?\n",
    "\n",
    "* No submission required! The notebooks are for your hands-on practice and learning only. You **do not** need to submit them anywhere to complete the course."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "f9915cf2",
   "metadata": {
    "papermill": {
     "duration": 0.004619,
     "end_time": "2025-11-14T18:01:50.314218",
     "exception": false,
     "start_time": "2025-11-14T18:01:50.309599",
     "status": "completed"
    },
    "tags": [],
    "vscode": {
     "languageId": "plaintext"
    }
   },
   "source": [
    "<hr>"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "7bbe4590",
   "metadata": {
    "papermill": {
     "duration": 0.004455,
     "end_time": "2025-11-14T18:01:50.323197",
     "exception": false,
     "start_time": "2025-11-14T18:01:50.318742",
     "status": "completed"
    },
    "tags": [],
    "vscode": {
     "languageId": "plaintext"
    }
   },
   "source": [
    "## Setup & Instructions FAQ"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "4491382a",
   "metadata": {
    "papermill": {
     "duration": 0.004511,
     "end_time": "2025-11-14T18:01:50.332356",
     "exception": false,
     "start_time": "2025-11-14T18:01:50.327845",
     "status": "completed"
    },
    "tags": [],
    "vscode": {
     "languageId": "plaintext"
    }
   },
   "source": [
    "### Kaggle setup FAQ"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "7a5d80ae",
   "metadata": {
    "papermill": {
     "duration": 0.004463,
     "end_time": "2025-11-14T18:01:50.341301",
     "exception": false,
     "start_time": "2025-11-14T18:01:50.336838",
     "status": "completed"
    },
    "tags": [],
    "vscode": {
     "languageId": "plaintext"
    }
   },
   "source": [
    "#### Do I need a Kaggle account?\n",
    "\n",
    "* If you are interested in using the hands-on labs, you will need a Kaggle account. Sign up at [www.kaggle.com](https://www.kaggle.com)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "7a9303b0",
   "metadata": {
    "papermill": {
     "duration": 0.004849,
     "end_time": "2025-11-14T18:01:50.350690",
     "exception": false,
     "start_time": "2025-11-14T18:01:50.345841",
     "status": "completed"
    },
    "tags": [],
    "vscode": {
     "languageId": "plaintext"
    }
   },
   "source": [
    "#### How do I sign up to Kaggle?\n",
    "\n",
    "* You can create an account at: [www.kaggle.com](https://www.kaggle.com). Make sure to [phone verify](https://www.kaggle.com/settings) your account, itâ€™s necessary for the courseâ€™s codelabs."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "87e58ad8",
   "metadata": {
    "papermill": {
     "duration": 0.005054,
     "end_time": "2025-11-14T18:01:50.360296",
     "exception": false,
     "start_time": "2025-11-14T18:01:50.355242",
     "status": "completed"
    },
    "tags": [],
    "vscode": {
     "languageId": "plaintext"
    }
   },
   "source": [
    "<hr>"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "b75288a2",
   "metadata": {
    "papermill": {
     "duration": 0.004521,
     "end_time": "2025-11-14T18:01:50.369222",
     "exception": false,
     "start_time": "2025-11-14T18:01:50.364701",
     "status": "completed"
    },
    "tags": [],
    "vscode": {
     "languageId": "plaintext"
    }
   },
   "source": [
    "## Kaggle Notebooks FAQ"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "7f705a51",
   "metadata": {
    "papermill": {
     "duration": 0.004652,
     "end_time": "2025-11-14T18:01:50.378378",
     "exception": false,
     "start_time": "2025-11-14T18:01:50.373726",
     "status": "completed"
    },
    "tags": [],
    "vscode": {
     "languageId": "plaintext"
    }
   },
   "source": [
    "### What are Kaggle Notebooks? Do I need them for the course?\n",
    "\n",
    "* [Kaggle Notebooks](https://www.kaggle.com/code) are a computational environment that enables reproducible and collaborative analysis.\n",
    "* You'll be provided links to codelabs (on Kaggle Notebooks) throughout the 5-day event. You can just read them on Kaggle Notebooks, but you can also **Copy & Edit** the notebooks to run them on your own."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "da2fd07a",
   "metadata": {
    "papermill": {
     "duration": 0.005238,
     "end_time": "2025-11-14T18:01:50.388099",
     "exception": false,
     "start_time": "2025-11-14T18:01:50.382861",
     "status": "completed"
    },
    "tags": [],
    "vscode": {
     "languageId": "plaintext"
    }
   },
   "source": [
    "### I'm new to Kaggle Notebooks. Where can I learn?\n",
    "\n",
    "* **YouTube Video:** You can learn by watching this video [How to use Kaggle Notebooks](https://www.youtube.com/watch?v=BPQDZLPtgDc)\n",
    "  * Sample Notebook: https://www.kaggle.com/code/polong/how-to-use-kaggle-notebooks"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "e498c5e5",
   "metadata": {
    "papermill": {
     "duration": 0.004806,
     "end_time": "2025-11-14T18:01:50.397435",
     "exception": false,
     "start_time": "2025-11-14T18:01:50.392629",
     "status": "completed"
    },
    "tags": [],
    "vscode": {
     "languageId": "plaintext"
    }
   },
   "source": [
    "### How do I make a copy of the codelab?\n",
    "\n",
    "* Watch the [\"How to use Kaggle Notebooks\" video timestamped here](https://youtu.be/BPQDZLPtgDc?si=-qGqamli7Ps4k98V&t=33)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "0135dbe2",
   "metadata": {
    "papermill": {
     "duration": 0.004448,
     "end_time": "2025-11-14T18:01:50.406501",
     "exception": false,
     "start_time": "2025-11-14T18:01:50.402053",
     "status": "completed"
    },
    "tags": [],
    "vscode": {
     "languageId": "plaintext"
    }
   },
   "source": [
    "### My notebook has errors when running it. What can I do?\n",
    "* Try to **Factory reset** your notebook\n",
    "* Determine if you [ran your code cells in the correct order](https://youtu.be/BPQDZLPtgDc?si=baIJh71p1xFwQby1&t=93) (did you miss a cell?)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "04ad333c",
   "metadata": {
    "papermill": {
     "duration": 0.004795,
     "end_time": "2025-11-14T18:01:50.415701",
     "exception": false,
     "start_time": "2025-11-14T18:01:50.410906",
     "status": "completed"
    },
    "tags": [],
    "vscode": {
     "languageId": "plaintext"
    }
   },
   "source": [
    "### How do I add my API key to my Kaggle Notebook via Kaggle Secrets?\n",
    "\n",
    "* You can watch the [\"How to use Kaggle Notebooks\" video timestamped here](https://youtu.be/BPQDZLPtgDc?si=9ycMCOIYrHKbGkPl&t=138)\n",
    "* Or, follow the instructions below to add your API key to your Kaggle Notebook as a Kaggle User Secret.\n",
    "\n",
    "![](https://storage.googleapis.com/kaggle-media/Images/5dgai_1.png)\n",
    "![](https://storage.googleapis.com/kaggle-media/Images/5dgai_2.png)\n",
    "![](https://storage.googleapis.com/kaggle-media/Images/5dgai_3.png)\n",
    "![](https://storage.googleapis.com/kaggle-media/Images/5dgai_4.png)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "e867657e",
   "metadata": {
    "papermill": {
     "duration": 0.004442,
     "end_time": "2025-11-14T18:01:50.424755",
     "exception": false,
     "start_time": "2025-11-14T18:01:50.420313",
     "status": "completed"
    },
    "tags": [],
    "vscode": {
     "languageId": "plaintext"
    }
   },
   "source": [
    "<hr>"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "ebcb071e",
   "metadata": {
    "papermill": {
     "duration": 0.004405,
     "end_time": "2025-11-14T18:01:50.433684",
     "exception": false,
     "start_time": "2025-11-14T18:01:50.429279",
     "status": "completed"
    },
    "tags": [],
    "vscode": {
     "languageId": "plaintext"
    }
   },
   "source": [
    "## Google AI Studio FAQ - Gemini API and API key"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "c9ac2ccd",
   "metadata": {
    "papermill": {
     "duration": 0.00497,
     "end_time": "2025-11-14T18:01:50.443093",
     "exception": false,
     "start_time": "2025-11-14T18:01:50.438123",
     "status": "completed"
    },
    "tags": [],
    "vscode": {
     "languageId": "plaintext"
    }
   },
   "source": [
    "#### How do I get an API key on Google AI Studio?\n",
    "\n",
    "1. Sign up for an AI Studio account here: https://aistudio.google.com/\n",
    "2. Generate an API key on this page: https://aistudio.google.com/app/apikey\n",
    "\n",
    "\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "4ed1979e",
   "metadata": {
    "papermill": {
     "duration": 0.004475,
     "end_time": "2025-11-14T18:01:50.452022",
     "exception": false,
     "start_time": "2025-11-14T18:01:50.447547",
     "status": "completed"
    },
    "tags": [],
    "vscode": {
     "languageId": "plaintext"
    }
   },
   "source": [
    "#### Will I get charged for using this API key?\n",
    "\n",
    "* When you request an API key, AI Studio will set you up on the free tier by default, as you can see in the screenshot below, and there is no charge within the free tier. You can check which tier your key is on through the [API key page in AI Studio](https://aistudio.google.com/app/apikey). \n",
    "* Note: You may be on a pay-as-you-go tier if you added a key to a Google Cloud project that already has billing enabled. To make it free, you can create a new project, do not set up billing (or remove it in the Cloud Console), and create the API key in that project. See [the billing docs](https://ai.google.dev/gemini-api/docs/billing) for more information on how to enable or disable billing.\n",
    "\n",
    "<img src=\"https://storage.googleapis.com/github-repo/kaggle-5days-ai/day0/ai-studio-api-key.png\" width=\"100%\" alt=\"AI Studio API key\">"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "0a33576b",
   "metadata": {
    "papermill": {
     "duration": 0.004378,
     "end_time": "2025-11-14T18:01:50.460801",
     "exception": false,
     "start_time": "2025-11-14T18:01:50.456423",
     "status": "completed"
    },
    "tags": [],
    "vscode": {
     "languageId": "plaintext"
    }
   },
   "source": [
    "<hr>"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "12ed4f2e",
   "metadata": {
    "papermill": {
     "duration": 0.005239,
     "end_time": "2025-11-14T18:01:50.470457",
     "exception": false,
     "start_time": "2025-11-14T18:01:50.465218",
     "status": "completed"
    },
    "tags": [],
    "vscode": {
     "languageId": "plaintext"
    }
   },
   "source": [
    "## Coursework FAQ"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "9b3ba032",
   "metadata": {
    "papermill": {
     "duration": 0.004646,
     "end_time": "2025-11-14T18:01:50.479716",
     "exception": false,
     "start_time": "2025-11-14T18:01:50.475070",
     "status": "completed"
    },
    "tags": [],
    "vscode": {
     "languageId": "plaintext"
    }
   },
   "source": [
    "### How do I submit the coursework?\n",
    "\n",
    "* You don't need to! \n",
    "* The capstone project will use knowledge you learn from the codelabs, so we recommend running through them all, but you don't have to submit anything directly from the codelabs, and it's OK if you used a different email to sign up to the course."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "9a57b32a",
   "metadata": {
    "papermill": {
     "duration": 0.004591,
     "end_time": "2025-11-14T18:01:50.488896",
     "exception": false,
     "start_time": "2025-11-14T18:01:50.484305",
     "status": "completed"
    },
    "tags": [],
    "vscode": {
     "languageId": "plaintext"
    }
   },
   "source": [
    "### How long do I have to do the coursework?\n",
    "\n",
    "* You are encouraged to do the coursework on the day it is released, as this allows you to ask questions that may be answered in the livestream, and get help from others that are focused on the same problems, but you are not required to do this. The coursework is not planned to be removed so you can go at your own pace.\n",
    "\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "a695993e",
   "metadata": {
    "papermill": {
     "duration": 0.004691,
     "end_time": "2025-11-14T18:01:50.498337",
     "exception": false,
     "start_time": "2025-11-14T18:01:50.493646",
     "status": "completed"
    },
    "tags": [],
    "vscode": {
     "languageId": "plaintext"
    }
   },
   "source": [
    "### I've done everything for today, what can I do next?\n",
    "\n",
    "* If you've finished reading the whitepaper, podcast, and the notebooks, then why not try building your own agents? You can also find more information on [ADK Docs page](https://google.github.io/adk-docs/) or discover [sample agents in ADK](https://github.com/google/adk-samples)."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "87257a65",
   "metadata": {
    "id": "yf40rRKcuh3R",
    "papermill": {
     "duration": 0.004629,
     "end_time": "2025-11-14T18:01:50.507567",
     "exception": false,
     "start_time": "2025-11-14T18:01:50.502938",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "## Errors\n",
    "\n",
    "### 1. This phone number can't be verified on Kaggle\n",
    "\n",
    "* If you are getting an error when trying to verify your phone number on Kaggle, ensure your phone is not signed up for the Do-Not-Call registry and double check your country code and area code are entered correctly. Ensure your phone number is not from a region sanctioned by the US government. If you are still having issues contact Kaggle support by filling out the form here: https://www.kaggle.com/contact#/account/activate/phone"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "86dbad3e",
   "metadata": {
    "id": "aTJrRBb4uh3S",
    "papermill": {
     "duration": 0.004709,
     "end_time": "2025-11-14T18:01:50.517258",
     "exception": false,
     "start_time": "2025-11-14T18:01:50.512549",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "### 2. No internet access\n",
    "\n",
    "This error may manifest in a number of ways. Here are some examples:\n",
    "\n",
    "* When accessing a Kaggle secret: `ConnectionError: Connection error trying to communicate with service`\n",
    "* When running pip install: `HTTPSConnection ...: Failed to establish a new connection: \\[Errno -3] Temporary failure in name resolution'`\n",
    "* `TransportError: Failed to retrieve http://metadata.google.internal/computeMetadata/v1/universe/universe_domain from the Google Compute Engine metadata service`\n",
    "* `400 Use of API-based models is not allowed for Internet-disabled notebooks`\n",
    "\n",
    "You can confirm that you have this error by creating a new code cell in the affected notebook and running this code:\n",
    "\n",
    "```bash\n",
    "!curl ipinfo.io\n",
    "```\n",
    "\n",
    "If you see `curl: (6) Could not resolve host: ipinfo.io`, then your notebook does not have internet access.\n",
    "\n",
    "#### Possible causes\n",
    "\n",
    "* Make sure you are signed in to Kaggle\n",
    "* Make sure your phone number is verified in your Kaggle account at kaggle.com/settings.\n",
    "\n",
    "    ![phone verify](https://storage.googleapis.com/kaggle-media/Images/5dgai_0.png)\n",
    "\n",
    "* Make sure the notebook has internet enabled:\n",
    "  * Find the switch by turning on the notebook sidebar\n",
    "  * Then find this button in the sidebar\n",
    "\n",
    "    <img src=\"https://storage.googleapis.com/github-repo/kaggle-5days-ai/day0/kaggle-notebooks-internet-enabled.png\" width=\"200px\" alt=\"Internet enabled\">\n",
    "\n",
    "* If `!curl ipinfo.io` still fails, you may need to refresh your browser tab and wait a few minutes.\n",
    "* Or, if you've done everything above, try a **ðŸ” Factory reset** of the notebook. If the factory reset works, please report this on Discord."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "3289b3af",
   "metadata": {
    "id": "bkkyRK8Fuh3S",
    "papermill": {
     "duration": 0.004778,
     "end_time": "2025-11-14T18:01:50.526523",
     "exception": false,
     "start_time": "2025-11-14T18:01:50.521745",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "### 3. ResourceExhausted: 429 Resource has been exhausted\n",
    "\n",
    "Each Gemini model on Google AI Studio has a dedicated per-minute quota. You can find the details for each model on the [Pricing page](https://ai.google.dev/gemini-api/docs/rate-limits). When you exceed this limit within a 60-second window, you may see a `ResourceExhausted` error.\n",
    "\n",
    "**Solution 0: Avoid Using Run All Cells**\n",
    "* Avoid using the Run all cells command as this can trigger a QPM limit resulting in 429 errors when calling the backing model. Suggested flow is to run each cell in order - one at a time.\n",
    "\n",
    "**Solution 1: Wait**\n",
    "* To fix it, you can wait up to 60 seconds and retry your request. Alternatively, you can try to switch to a different model (e.g., `gemini-2.5-flash` or `gemini-2.0-flash-lite`).\n",
    "\n",
    "\n",
    "**Solution 2: Enable billing in Google AI Studio**\n",
    "\n",
    "* If you wish, you can enable billing to enable the paid tier of quota. Be sure to read the [pricing page](https://ai.google.dev/gemini-api/docs/pricing) to find out how much it costs, the [rate limits page](https://ai.google.dev/gemini-api/docs/rate-limits) to see the limits, and the [billing page](https://ai.google.dev/gemini-api/docs/billing) for details on how to turn billing on or off. Note that billing is not required for this course, but if you wish to use higher quota, this is one way of doing so.\n",
    "\n",
    "**Solution 3: Use the free tier with Vertex AI Express Mode**\n",
    "\n",
    "* If you have never used Google Cloud before, you can sign up for an express mode account in a free tier to try Vertex AI for free for up to 90 days, within the specified quotas. You don't need to provide billing information to sign up in the free tier. You can upgrade to a paid tier by adding a billing account. Note that billing is not required for this course, but if you wish to use higher quota, this is one way of doing so.\n",
    "* To use Vertex AI Express Mode, [create an account](https://cloud.google.com/vertex-ai/generative-ai/docs/start/express-mode/overview), then create an API key, and use that API key for your `GOOGLE_API_KEY` secret. You will also need to set `export GOOGLE_GENAI_USE_VERTEXAI=TRUE` in your code before running your agent. See documentation here: https://google.github.io/adk-docs/agents/models/#method-b-vertex-ai-express-mode\n",
    "\n",
    "**Solution 4: Use Vertex AI (with billing)**\n",
    "\n",
    "* If you have previously used Google Cloud, you can also use Gemini via Vertex AI. To do so, you will need to set different environment variables, as seen below or in the [ADK documentation](https://google.github.io/adk-docs/agents/models/#google-cloud-vertex-ai). Note that using Vertex AI with billing enabled means that calls to Gemini will be billed. Note that billing is not required for this course, but if you wish to use higher quota, this is one way of doing so. You can find supported regions for each model card in the documentation (e.g. [docs for Gemini 2.5 Flash Lite](https://docs.cloud.google.com/vertex-ai/generative-ai/docs/models/gemini/2-5-flash-lite))\n",
    "  ```\n",
    "  export GOOGLE_CLOUD_PROJECT=\"YOUR_PROJECT_ID\"\n",
    "  export GOOGLE_CLOUD_LOCATION=\"YOUR_VERTEX_AI_LOCATION\" # e.g., global, asia-northeast1\n",
    "  ```"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "22657bd4",
   "metadata": {
    "papermill": {
     "duration": 0.004467,
     "end_time": "2025-11-14T18:01:50.535525",
     "exception": false,
     "start_time": "2025-11-14T18:01:50.531058",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "### 4. `run_debug` or `run_async` Errors \n",
    "#### HTTP Error codes: 429, 500, 503, 504)\n",
    "\n",
    "When working with LLMs, you may encounter transient HTTP errors:\n",
    "\n",
    "- **429**: Rate limit exceeded (too many requests)\n",
    "- **500**: Internal server error\n",
    "- **503**: Service temporarily unavailable\n",
    "- **504**: Gateway timeout\n",
    "\n",
    "These errors are usually temporary and can be resolved by **automatically retrying** the request with exponential backoff.\n",
    "\n",
    "#### Solution: Add Retry Configuration\n",
    "\n",
    "Follow these two steps to handle HTTP errors automatically:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "ba6e555e",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-11-14T18:01:50.546914Z",
     "iopub.status.busy": "2025-11-14T18:01:50.546541Z",
     "iopub.status.idle": "2025-11-14T18:02:46.322518Z",
     "shell.execute_reply": "2025-11-14T18:02:46.321208Z"
    },
    "papermill": {
     "duration": 55.78868,
     "end_time": "2025-11-14T18:02:46.328998",
     "exception": false,
     "start_time": "2025-11-14T18:01:50.540318",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "âœ… Retry configuration created\n"
     ]
    }
   ],
   "source": [
    "# Step 1: Import required modules and define retry configuration\n",
    "from google.genai import types\n",
    "from google.adk.models.google_llm import Gemini\n",
    "\n",
    "retry_config = types.HttpRetryOptions(\n",
    "    attempts=5,  # Maximum number of retry attempts\n",
    "    exp_base=7,  # Exponential backoff multiplier (delay grows: 1s, 7s, 49s...)\n",
    "    initial_delay=1,  # Initial delay before first retry (in seconds)\n",
    "    http_status_codes=[429, 500, 503, 504],  # Retry on these HTTP errors\n",
    ")\n",
    "\n",
    "print(\"âœ… Retry configuration created\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "210669c7",
   "metadata": {
    "papermill": {
     "duration": 0.005655,
     "end_time": "2025-11-14T18:02:46.339352",
     "exception": false,
     "start_time": "2025-11-14T18:02:46.333697",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "**Step 2: Apply retry configuration to your model**\n",
    "\n",
    "When creating your agent, replace the simple model string with a `Gemini` object that includes retry options:\n",
    "\n",
    "**Before (without retry):**\n",
    "```python\n",
    "agent = LlmAgent(\n",
    "    model=\"gemini-2.5-flash-lite\",  # Simple string - no retry\n",
    "    ...\n",
    ")\n",
    "```\n",
    "\n",
    "**After (with retry):**\n",
    "```python\n",
    "agent = LlmAgent(\n",
    "    model=Gemini(\n",
    "        model=\"gemini-2.5-flash-lite\",\n",
    "        retry_options=retry_config  # Adds automatic retry\n",
    "    ),\n",
    "    ...\n",
    ")\n",
    "```"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "f918bf91",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-11-14T18:02:46.351722Z",
     "iopub.status.busy": "2025-11-14T18:02:46.350684Z",
     "iopub.status.idle": "2025-11-14T18:02:46.360538Z",
     "shell.execute_reply": "2025-11-14T18:02:46.358677Z"
    },
    "papermill": {
     "duration": 0.018334,
     "end_time": "2025-11-14T18:02:46.362470",
     "exception": false,
     "start_time": "2025-11-14T18:02:46.344136",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "âœ… Agent created with automatic retry on HTTP errors\n"
     ]
    }
   ],
   "source": [
    "# Example: Complete agent with retry configuration\n",
    "from google.adk.agents import LlmAgent\n",
    "\n",
    "agent = LlmAgent(\n",
    "    name=\"my_agent\",\n",
    "    model=Gemini(\n",
    "        model=\"gemini-2.5-flash-lite\",\n",
    "        retry_options=retry_config,  # Apply retry config here\n",
    "    ),\n",
    "    instruction=\"You are a helpful assistant.\",\n",
    ")\n",
    "\n",
    "print(\"âœ… Agent created with automatic retry on HTTP errors\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "2e024f44",
   "metadata": {
    "id": "RZuJJWdfuh3S",
    "papermill": {
     "duration": 0.005198,
     "end_time": "2025-11-14T18:02:46.374276",
     "exception": false,
     "start_time": "2025-11-14T18:02:46.369078",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "### 5. InvalidArgument or invalid API key\n",
    "\n",
    "This may happen if you have copied only part of the API key, or copied some extra characters. **After running the Secrets cell**, add a new code cell and run this:\n",
    "\n",
    "```python\n",
    "print(f'{len(GOOGLE_API_KEY)=}, {GOOGLE_API_KEY[:4]=}, {GOOGLE_API_KEY[-4:]=}')\n",
    ">>> len(GOOGLE_API_KEY)=39, GOOGLE_API_KEY[:4]='AIza', GOOGLE_API_KEY[-4:]='7E14'\n",
    "```\n",
    "\n",
    "The output should be similar to the above. The first 4 characters will be `AIza`, the last four could be any alphanumeric characters, and the length should be around 35-40 characters. If you have anything different, follow the steps above to add your API key from AI Studio to Kaggle Secrets again."
   ]
  }
 ],
 "metadata": {
  "colab": {
   "provenance": []
  },
  "kaggle": {
   "accelerator": "none",
   "dataSources": [],
   "isGpuEnabled": false,
   "isInternetEnabled": false,
   "language": "python",
   "sourceType": "notebook"
  },
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.11.13"
  },
  "papermill": {
   "default_parameters": {},
   "duration": 64.443452,
   "end_time": "2025-11-14T18:02:49.544844",
   "environment_variables": {},
   "exception": null,
   "input_path": "__notebook__.ipynb",
   "output_path": "__notebook__.ipynb",
   "parameters": {},
   "start_time": "2025-11-14T18:01:45.101392",
   "version": "2.6.0"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
